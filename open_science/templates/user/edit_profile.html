{% from "helpers/form_helper.html" import render_edit_profile_field %}

{% extends 'base.html' %}


{% if current_user.is_researcher() %}
    {% set user_type = 'researcher'%}
{% else %}
    {% set user_type = 'standard_user'%}
{% endif %}

{% block scripts%}
<script>
function showReviewWarning(value) {
    var mails_limit = document.querySelector('#review_mails_limit').value;
    if (mails_limit==0){
        alert("With this choice, you will never be asked by researcher.community to peer review papers, and the option to ask peers to review your papers will be disabled.");
    }
}


$(document).ready(function() {
    if ('{{user_type}}' == 'standard_user')
    {
        $("#researcher_options :input").prop('disabled', true);
        document.getElementById('researcher_options').style.color='#A9A9A9';
    }
});
</script>

{% endblock %}

{% block content %}

<div class="profile-edit-wrapper">
    <form method="POST" enctype="multipart/form-data">
        {{ form.hidden_tag() }}
        <h1>
           Edit account
        </h1>
        <div class="profile-pic-selection-wrapper">
            <img src="{{url_for('static',filename='res/profileImages/'~current_user.get_id()~'.jpg') if current_user.has_photo else url_for('static',filename='res/profileImages/img.jpg')}}" class="edit-profile-picture" />
            <div class="profile-edit-input-wrapper">
                <div clas="label-wrapper">{{ form.profile_image.label()}}</div>
                <div class="label-wrapper">(Please use a photo of your face if you decide to set a photo)</div>
                <div class="input-wrapper">{{ form.profile_image()}}</div>
                {% for error in form.profile_image.errors %}
                <span style="color: red;">[{{ error }}]</span>
                {% endfor %}
            </div>
        </div>
        
        <br>
       
        <div class="double-input-wrapper">
            {{ render_edit_profile_field(form.first_name,"First name") }}
            {{ render_edit_profile_field(form.second_name,"Last name") }}
        </div>

        {{ render_edit_profile_field(form.about_me,"About me","(Will be displayed on your profile page. You may write any information you wish to be publicly visible)") }}
 
        <div class="double-input-wrapper">
            {{ render_edit_profile_field(form.email,"Email address") }}
            {{ render_edit_profile_field(form.affiliation,"Affiliation") }}
        </div>

        <div class="double-input-wrapper">
            {{ render_edit_profile_field(form.orcid,"ORCID") }}
            {{ render_edit_profile_field(form.google_scholar,"Google scholar ID") }}
        </div>
   
        {{ render_edit_profile_field(form.personal_website,"Personal website url") }}

        
        <div class="profile-edit-input-wrapper">
            <div class="label-wrapper">{{ form.notifications_frequency.label() }}</div>
            <div class="label-wrapper">
                When others post messages under my papers, I want to be notified every:
            </div>
            <div class="input-wrapper">{{ form.notifications_frequency()}} </div>  
            <div class="label-wrapper">
                (Note: you will always be notified immediately when your paper is reviewed)
            </div>
        </div> 


        <div id="researcher_options">

            <div class="profile-edit-input-wrapper">
                <div class="label-wrapper">{{ form.review_mails_limit.label() }}</div>
                <div class="label-wrapper">
                    Scientific community relies on peer review.
                    <br>
                    We will periodically send you emails with new papers similar to your scientific profile of interest (based on your papers you provided).
                    <br>
                    Authors of some of these new papers may ask for an opinion or a review.<br>How many emails per month do you wish to receive at most?<br>(This is the maximal number, applicable only if you are selected as a reviewer for your peers).
                </div>
                <div class="input-wrapper">{{ form.review_mails_limit(id='review_mails_limit',oninput="showReviewWarning(value)")}} </div>
            </div>   

            
            <div class="label-wrapper">{{ form.calibration_files.label()}}</div>
            <div class="label-wrapper">
                These papers will not be published here, so you can even upload papers for which you have transferred copyright. These articles are only used to extract raw text in order to identify your area of expertise.
            </div>
            {{ form.calibration_files()}}
            {% for error in form.calibration_files.errors %}
            <span style="color: red;">[{{ error }}]</span>
            {% endfor %}
            <br><br>
            Uploaded calibration files:
            <br>
            {% for calibration_paper in calibration_papers %}
                {{calibration_paper.description}}

                <a href="{{url_for('user.delete_calibration_paper', paper_id=calibration_paper.id)}}">
                    <img src="{{url_for('static', filename='res/del.png')}}"/>
                </a>

                <br>
            {% endfor %}
            
            <br><br>
    

        </div>

        <div class="buttons-wrapper">
            {{ form.submit(class="large-button main-button")}}
            <a href="{{url_for('auth.change_password_page')}}">
                <button type="button" class="large-button secondary-button" style="background-color: grey;">Change password</button>
            </a>
            <a href="{{url_for('auth.delete_profile_page')}}">
                <button type="button" class="large-button secondary-button" style="background-color: grey;">Delete profile</button>
            </a>
        </div>
    </form>
</div>



{% endblock %}
