

{% block scripts %}

<script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
<script>
    const id = {{user_id}};
        async function loadJSONAndPlot() {
            try {
                const response = await fetch('/generate_users_plot_data');
                const data = await response.json();
                if (data.length === 0) {
                    console.log('No data available');
                    return;
                }

                const x = [];
                const y = [];
                const z = [];
                const text = [];

                const xHighlight = [];
                const yHighlight = [];
                const zHighlight = [];
                const textHighlight = [];

                data.forEach((row) => {
                    if (row.id === id)  {
                        xHighlight.push(row.x);
                        yHighlight.push(row.y);
                        zHighlight.push(row.z);
                        textHighlight.push(row.text);
                    } else {
                        x.push(row.x);
                        y.push(row.y);
                        z.push(row.z);
                        text.push(row.text);
                    }
                });

                const trace1 = {
                    x: x,
                    y: y,
                    z: z,
                    mode: 'markers',
                    type: 'scatter3d',
                    hoverinfo: 'text',
                    text: text,
                    marker: {
                        size: 5,
                        color: 'blue'
                    }
                };

                const trace2 = {
                    x: xHighlight,
                    y: yHighlight,
                    z: zHighlight,
                    mode: 'markers',
                    type: 'scatter3d',
                    hoverinfo: 'text',
                    text: textHighlight,
                    marker: {
                        size: 7,
                        color: 'red'
                    }
                };

                const layout = {
                    title: '',
                    showlegend: false,
                    scene: {
                        xaxis: {backgroundcolor: 'rgba(200,200,200,0.9)', showbackground: true},
                        yaxis: {backgroundcolor: 'rgba(200,200,200,0.9)', showbackground: true},
                        zaxis: {backgroundcolor: 'rgba(200,200,200,0.9)', showbackground: true},
                        xaxis_title: '',
                        yaxis_title: '',
                        zaxis_title: '',
                        xaxis_showticklabels: false,
                        yaxis_showticklabels: false,
                        zaxis_showticklabels: false
                    }
                };

                Plotly.newPlot('users_plot', [trace1, trace2], layout);
            } catch (error) {
                console.error('Error loading JSON data:', error);
            }
        }


        document.addEventListener('DOMContentLoaded', loadJSONAndPlot);
    </script>
{% endblock %}

{% block content %}



    <div id="users_plot" style="width:90vw; height:90vh;">
    </div>



{% endblock %}